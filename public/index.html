<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Performance Search Engine</title>
    <style>
        body { 
            font-family: monospace; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #1e1e1e; 
            color: #d4d4d4; 
        }
        h1 { 
            text-align: left; 
            color: #569cd6; 
            font-size: 24px;
            margin-bottom: 30px;
        }
        
        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 15px; 
            margin-bottom: 30px; 
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }
        .stat-item { 
            text-align: left; 
        }
        .stat-label { 
            font-size: 12px; 
            color: #808080; 
            margin-bottom: 5px;
            display: block;
        }
        .stat-value { 
            font-size: 16px; 
            color: #4ec9b0; 
        }
        
        .search-container { 
            margin-top: 20px; 
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        input[type="text"] { 
            flex-grow: 1;
            background: #252526; 
            border: 1px solid #3c3c3c; 
            color: #d4d4d4;
            padding: 10px; 
            font-family: monospace;
            font-size: 14px;
        }
        input[type="text"]:focus { 
            outline: 1px solid #007fd4; 
        }
        
        button { 
            background-color: #0e639c; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            font-family: monospace;
        }
        button:hover { 
            background-color: #1177bb; 
        }

        #results { 
            margin-top: 20px; 
            font-size: 13px;
        }
        .result-item { 
            padding: 5px 0; 
            border-bottom: 1px solid #333; 
            color: #ce9178;
        }
        .no-results { color: #808080; }
        
        .status-ok { color: #6a9955; }
        .status-warn { color: #dcdcaa; }
        .status-err { color: #f48771; }
    </style>
</head>
<body>
    <h1>> ./High_Performance_Search_Engine_Cpp_Levenshtein</h1>
    
    <div class="dashboard">
        <div class="stat-item">
            <span class="stat-label">MEMORY_RSS</span>
            <span class="stat-value" id="ram-usage">-- MB</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">LATENCY_SINGLE</span>
            <span class="stat-value" id="latency">-- ms</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">LATENCY_MULTI (AVG)</span>
            <span class="stat-value" id="latency-multi">-- ms</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">STATUS</span>
            <span class="stat-value status-ok" id="status-text">INIT</span>
        </div>
    </div>

    <div class="search-container">
        <div class="input-group">
            <input type="text" id="query" placeholder="grep pattern (e.g., 'fast', 'search', 'algorithm')..." autofocus>
            <button onclick="performSearch()">EXECUTE</button>
        </div>
        <div id="results"></div>
    </div>

    <script>
        // Dashboard Polling
        setInterval(async () => {
            try {
                const res = await fetch('/status');
                const data = await res.json();
                
                const ramEl = document.getElementById('ram-usage');
                ramEl.textContent = `${data.rss} MB`;
                
                if (parseFloat(data.rss) > 200) {
                    ramEl.className = 'stat-value status-err';
                } else {
                    ramEl.className = 'stat-value status-ok';
                }

                document.getElementById('latency').textContent = `${data.lastSearchDuration || '--'} ms`;
                document.getElementById('latency-multi').textContent = `${data.lastMultiThreadDuration || '--'} ms`;
                
                const statusText = document.getElementById('status-text');
                statusText.textContent = data.mode.toUpperCase();
                if (data.mode === 'Debug') {
                    statusText.className = 'stat-value status-warn';
                } else {
                    statusText.className = 'stat-value status-ok';
                }
            } catch (e) {
                console.error("Monitor failed", e);
            }
        }, 1000);

        const input = document.getElementById("query");
        input.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                performSearch();
            }
        });

        async function performSearch() {
            const query = input.value.trim();
            const resultsDiv = document.getElementById("results");
            
            if (!query) {
                resultsDiv.innerHTML = '';
                return;
            }

            resultsDiv.innerHTML = '<div class="no-results">Processing...</div>';
            
            // Trigger benchmark in background
            fetch(`/benchmark?q=${encodeURIComponent(query)}`).catch(console.error);
            
            try {
                const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                resultsDiv.innerHTML = '';

                if (data.results && data.results.length > 0) {
                    data.results.forEach(line => {
                        const div = document.createElement('div');
                        div.className = 'result-item';
                        div.textContent = `> ${line}`;
                        resultsDiv.appendChild(div);
                    });
                } else {
                    resultsDiv.innerHTML = '<div class="no-results">exit code 1: no matches found</div>';
                }
            } catch (err) {
                resultsDiv.innerHTML = `<div class="no-results status-err">Error: ${err.message}</div>`;
            }
        }
    </script>

</body>
</html>
